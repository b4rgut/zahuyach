<!-- Posts list/grid container -->
<div class="posts-container">
    {{#each posts}}
    <article class="post-card group">
        <!-- Post header -->
        <header class="post-header">
            <div class="flex flex-col space-y-3">
                <!-- Title -->
                <h2 class="post-title">
                    <a href="/posts/{{slug}}" class="post-title-link">
                        {{title}}
                    </a>
                </h2>

                <!-- Meta information -->
                <div class="post-meta">
                    <div class="flex items-center flex-wrap gap-4 text-sm text-gh-fg-muted">
                        <!-- Date -->
                        <time datetime="{{date_iso}}" class="flex items-center space-x-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            <span>{{date_formatted}}</span>
                        </time>

                        <!-- Reading time -->
                        {{#if reading_time}}
                        <span class="flex items-center space-x-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span>{{reading_time}} мин</span>
                        </span>
                        {{/if}}

                        <!-- Category -->
                        {{#if category}}
                        <span class="flex items-center space-x-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                            </svg>
                            <a href="/categories/{{category.slug}}" class="text-gh-accent-fg hover:text-gh-accent-muted transition-colors">
                                {{category.name}}
                            </a>
                        </span>
                        {{/if}}
                    </div>
                </div>
            </div>
        </header>

        <!-- Post content -->
        <div class="post-content">
            <!-- Excerpt -->
            <div class="post-excerpt">
                {{excerpt}}
            </div>

            <!-- Tags -->
            {{#if tags}}
            <div class="post-tags">
                <div class="flex flex-wrap gap-2">
                    {{#each tags}}
                    <button
                        class="tag-filter inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-gh-canvas-subtle text-gh-fg-muted hover:bg-gh-accent-subtle hover:text-gh-accent-fg border border-gh-border-default hover:border-gh-accent-emphasis transition-all cursor-pointer"
                        data-tag="{{this}}"
                        title="Фильтровать по тегу: {{this}}"
                    >
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                        </svg>
                        {{this}}
                    </button>
                    {{/each}}
                </div>
            </div>
            {{/if}}
        </div>

        <!-- Post footer -->
        <footer class="post-footer">
            <div class="flex items-center justify-between">
                <!-- Read more link -->
                <a
                    href="/posts/{{slug}}"
                    class="inline-flex items-center text-gh-accent-fg hover:text-gh-accent-muted font-medium group-hover:underline transition-all"
                >
                    <span>Читать далее</span>
                    <svg class="w-4 h-4 ml-1 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>

                <!-- Action buttons -->
                <div class="flex items-center space-x-2">
                    {{#if show_actions}}
                    <!-- Share button -->
                    <button
                        class="p-2 text-gh-fg-muted hover:text-gh-fg-default hover:bg-gh-canvas-subtle rounded-md transition-colors"
                        onclick="sharePost('{{title}}', '{{permalink}}')"
                        title="Поделиться"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                        </svg>
                    </button>

                    <!-- Bookmark button -->
                    <button
                        class="p-2 text-gh-fg-muted hover:text-gh-fg-default hover:bg-gh-canvas-subtle rounded-md transition-colors bookmark-btn"
                        onclick="toggleBookmark('{{slug}}')"
                        title="Добавить в закладки"
                        data-post-slug="{{slug}}"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
                        </svg>
                    </button>
                    {{/if}}
                </div>
            </div>
        </footer>
    </article>
    {{/each}}
</div>

<!-- Empty state -->
{{#unless posts}}
<div class="empty-state">
    <div class="text-center py-16">
        <div class="mx-auto w-24 h-24 bg-gh-canvas-subtle rounded-full flex items-center justify-center mb-6">
            <svg class="w-12 h-12 text-gh-fg-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
        </div>
        <h3 class="text-xl font-semibold text-gh-fg-default mb-2">Статьи не найдены</h3>
        <p class="text-gh-fg-muted mb-6">Попробуйте изменить критерии поиска или фильтрации</p>
        <button
            class="inline-flex items-center px-4 py-2 bg-gh-accent-emphasis text-gh-fg-on-emphasis rounded-md hover:bg-opacity-90 transition-colors"
            onclick="clearAllFilters()"
        >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Сбросить фильтры
        </button>
    </div>
</div>
{{/unless}}

<style>
/* List view styles */
.posts-list-view .posts-container {
    @apply space-y-6;
}

.posts-list-view .post-card {
    @apply bg-gh-canvas-overlay border border-gh-border-default rounded-lg p-6 hover:border-gh-border-muted hover:shadow-lg transition-all duration-200;
}

.posts-list-view .post-header {
    @apply mb-4;
}

.posts-list-view .post-title {
    @apply text-xl font-semibold;
}

.posts-list-view .post-title-link {
    @apply text-gh-fg-default hover:text-gh-accent-fg transition-colors;
}

.posts-list-view .post-meta {
    @apply mt-3;
}

.posts-list-view .post-content {
    @apply space-y-4;
}

.posts-list-view .post-excerpt {
    @apply text-gh-fg-muted leading-relaxed;
}

.posts-list-view .post-tags {
    @apply mt-4;
}

.posts-list-view .post-footer {
    @apply mt-6 pt-4 border-t border-gh-border-muted;
}

/* Grid view styles */
.posts-grid-view .posts-container {
    @apply grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6;
}

.posts-grid-view .post-card {
    @apply bg-gh-canvas-overlay border border-gh-border-default rounded-lg p-5 hover:border-gh-border-muted hover:shadow-lg transition-all duration-200 flex flex-col h-full;
}

.posts-grid-view .post-header {
    @apply mb-3;
}

.posts-grid-view .post-title {
    @apply text-lg font-semibold;
}

.posts-grid-view .post-title-link {
    @apply text-gh-fg-default hover:text-gh-accent-fg transition-colors line-clamp-2;
}

.posts-grid-view .post-meta {
    @apply mt-2;
}

.posts-grid-view .post-meta .flex {
    @apply flex-col items-start space-y-1;
    gap: 0.25rem;
}

.posts-grid-view .post-content {
    @apply space-y-3 flex-1;
}

.posts-grid-view .post-excerpt {
    @apply text-gh-fg-muted text-sm leading-relaxed line-clamp-3;
}

.posts-grid-view .post-tags {
    @apply mt-3;
}

.posts-grid-view .post-tags .flex {
    @apply flex-wrap gap-1;
}

.posts-grid-view .post-tags .tag-filter {
    @apply text-xs px-2 py-0.5;
}

.posts-grid-view .post-footer {
    @apply mt-4 pt-3 border-t border-gh-border-muted;
}

.posts-grid-view .post-footer .flex {
    @apply flex-col space-y-2;
}

/* Utility classes for text truncation */
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .posts-grid-view .posts-container {
        @apply grid-cols-1;
    }

    .posts-list-view .post-card {
        @apply p-4;
    }

    .posts-list-view .post-title {
        @apply text-lg;
    }
}

/* Animation for new posts */
.post-card {
    animation: fadeInUp 0.4s ease-out forwards;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Hover effects */
.post-card:hover {
    transform: translateY(-2px);
}

.posts-grid-view .post-card:hover {
    transform: translateY(-4px);
}
</style>

<script>
// Share functionality
function sharePost(title, url) {
    if (navigator.share) {
        navigator.share({
            title: title,
            url: url
        }).catch(console.error);
    } else {
        // Fallback to copying to clipboard
        navigator.clipboard.writeText(url).then(() => {
            showNotification('Ссылка скопирована в буфер обмена');
        }).catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = url;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showNotification('Ссылка скопирована в буфер обмена');
        });
    }
}

// Bookmark functionality
function toggleBookmark(slug) {
    const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
    const bookmarkBtn = document.querySelector(`[data-post-slug="${slug}"]`);
    const isBookmarked = bookmarks.includes(slug);

    if (isBookmarked) {
        const index = bookmarks.indexOf(slug);
        bookmarks.splice(index, 1);
        bookmarkBtn.classList.remove('text-gh-accent-fg');
        bookmarkBtn.classList.add('text-gh-fg-muted');
        showNotification('Статья удалена из закладок');
    } else {
        bookmarks.push(slug);
        bookmarkBtn.classList.remove('text-gh-fg-muted');
        bookmarkBtn.classList.add('text-gh-accent-fg');
        showNotification('Статья добавлена в закладки');
    }

    localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
}

// Clear all filters
function clearAllFilters() {
    const searchInput = document.getElementById('search-input');
    const sortSelect = document.getElementById('sort-select');
    const activeFilters = document.getElementById('active-filters');

    searchInput.value = '';
    sortSelect.value = 'date-desc';
    activeFilters.classList.add('hidden');
    activeFilters.querySelector('div').innerHTML = '<span class="text-sm text-gh-fg-muted">Активные фильтры:</span>';

    // Trigger refresh
    htmx.ajax('GET', '/api/posts/reset', {
        target: '#posts-container'
    });
}

// Show notification
function showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'fixed top-4 right-4 z-50 bg-gh-canvas-overlay border border-gh-border-default rounded-lg px-4 py-2 shadow-lg transform translate-x-full transition-transform duration-300';
    notification.innerHTML = `
        <div class="flex items-center space-x-2">
            <svg class="w-4 h-4 text-gh-success-fg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <span class="text-sm text-gh-fg-default">${message}</span>
        </div>
    `;

    document.body.appendChild(notification);

    // Animate in
    setTimeout(() => {
        notification.classList.remove('translate-x-full');
    }, 10);

    // Animate out and remove
    setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}

// Initialize bookmarks on page load
document.addEventListener('DOMContentLoaded', function() {
    const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
    bookmarks.forEach(slug => {
        const bookmarkBtn = document.querySelector(`[data-post-slug="${slug}"]`);
        if (bookmarkBtn) {
            bookmarkBtn.classList.remove('text-gh-fg-muted');
            bookmarkBtn.classList.add('text-gh-accent-fg');
        }
    });
});
</script>
